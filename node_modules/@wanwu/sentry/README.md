# 项目名

@wanwu/sentry

`1.0.39` 移除了sentry,需需要使用sentry请使用其他版本

## 接入指南

#### 第一步
npm install @wanwu/sentry --save-dev

#### 第二步
在入口文件处初始化sentry

```javascript
import mySentry from '@wanwu/sentry'

mySentry.init({
    dsn: 'string',
    environment: 'string',
    env: 'vue' | 'xcx' | 'javascript',
    vue: Vue,  // vue实例 vue环境下传
    wx: wx,  // wx实例  wx环境下传
    window: Window, // window实例 vue 和 JavaScript 环境下传
    ignoreErrors: [/'未登录'/g] // 指定屏蔽上报内容 成员可是正则和字符串 可选参数
    blacklistUrls: [/192.168.x.x/g] // 上报IP/地址黑名单 成员可是正则和字符串 可选参数
    whitelistUrls: [/192.168.x.x/g] // 上报IP/地址白名单 成员可是正则和字符串 可选参数
    beforeBreadcrumb: (breadcrumb: Sentry.Breadcrumb, hint: any) => {
        // 上报面包屑 自定义操作
        return breadcrumb
    },
    beforeSend: (event: Sentry.Event, hint: any) => {
        // 上报事件 自定义操作
        return Event
    }
    callback: () => {
        // sentry 初始化后用户的自定义操作
    }
})
```

#### 第三步
设置全局用户信息和tags
```javascript
import mySentry from '@wanwu/sentry'

setUserOrTag({
    user: 'any',  // 用户信息
    tags: 'any',  // tags
    tag: { key: 'key', value: 'val'}, // 特定tag
    content: { key: 'key', value: 'val'}  // 上下文内容
})
```

#### 第四步
在关键文件设置错误类型
```javascript
import mySentry from '@wanwu/sentry'

let myError = mySentry.setMySentryError({
    type: mySentry.ERROR_TYPE.Xhr || any, // 指定的错误类型
    level: mySentry.ERROR_LEVEL.Error // 指定错误等级
})
```

#### 第五步
在需要上报的地方上报错误

 ```javascript
 import mySentry from '@wanwu/sentry'

 mySentry.logError(err)

/**    
err: {
    message: 需要上报的标题
    level: 错误等级  // 建议统一设置
    type:  错误类型  // 建议统一设置
    extra: 需要上报的内容
    tag: tag // 当前错误的tag
}
**/
 ```

## 内置错误类型
根据 mall-web 项目统计，内置提供下列四种类型，主要筛选用
```javascript
const ERROR_TYPE = {
    Xhr: 'xhr',   // 网络相关
    IMWarning: 'IM_Warning', // im相关
    JsBridge: 'JsBridge' // 桥接相关
}
const ERROR_LEVEL = {
    Fatal: Sentry.Severity['Fatal'], // 致命
    Error: Sentry.Severity['Error'], // 错误
    Warning: Sentry.Severity['Warning'], // 警告
    Log: Sentry.Severity['Log'], // 日志
    Info: Sentry.Severity['Info'], // 信息
    Debug: Sentry.Severity['Debug'], // 调试
    Critical: Sentry.Severity['Critical'] // 严重
}
```