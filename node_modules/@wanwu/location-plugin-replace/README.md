# replace四端统一跳转插件

### replace(to, from, prevent, eventCenter, options)
四端跳转插件

| Param | Type | Description |
| --- | --- | --- |
| to | <code>WLocation</code> | 目标路由对象 |
| from | <code>WLocation</code> | 当前路由对象 |
| prevent | <code>function</code> | 生成阻止跳转的返回值 |
| eventCenter | <code>EventEmitter</code> | 事件中心（插件和location直接交互信息） |
| options | <code>Object</code> | 配置项，从location.[push/replace] |
| options.callApp | <code>boolean</code> | h5内跳转目标页是否要打开app |
| options.redirectUrl | <code>String</code> | 唤起失败的回跳地址，默认跳转到目标路由 |
| options.forcedDownload | <code>boolean</code> | 此次跳转是否强制下载app（不下载不能打开目标页面） |
| options.jumpH5 | <code>boolean</code> | 此次强制跳转h5页面 |
| options.closeWebview | <code>boolean</code> | 微信小程序中的嵌套h5页面的replace在小程序环境不生效，使用redirectTo会关闭上个webview容器，所以在使用时对于只有一个页面的webview可以通过传入closeWebview来模拟replace，webview容器中有多个页面的时候会关闭该容器，造成多级页面路由丢失； |

### 资源位配置

> 资源位配置地址
http://seller.wanwudezhi.com/resourceNiche/resourceChildList?resourceId=81

> Tips: 新增测试环境资源位468，当api环境切换为develop时，使用测试环境资源位，方便测试
http://seller_test.wanwudezhi.com/resourceNiche/resourceChildList?resourceId=468


| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| base | <code>string</code> | h5项目基础路径（当push的route对象的base符合） |
| h5 | <code>string</code> | h5路径（当push的route对象的path符合） |
| xcx | <code>string</code> | 对应的小程序路径 |
| appUrl | <code>string</code> | 对应的app路径（当path是app路由时，也可以反向转成h5路由） |
| preventH5Jump | <code>boolean</code> | h5阻止跳转，在h5环境中是否需要阻止跳转 |
| minVersion | <code>string</code> | 最低支持版本号（低于此版本会提示升级） |
| maxVersion | <code>string</code> | 最高支持版本号（高于此版本则不适用此规则） |
| queryRule | <code>string</code> | query参数名替换规则-适用app-例子h5:app;c:d;（为了兼容h5参数名和app参数名不一致时使用，理论上应该避免这种情况） |
| queryValueMap | <code>string</code> | query参数值替换map-适用app-例子-tab::0:all,1:waitPay;status::0:a,1:b（为了兼容h5value和app value不一致时使用，理论上应该避免这种情况） |
| rule | <code>string</code> | h5路径-兼容老数据（在版本迭代过程中，换了更合理的参数名字） |
| pluginName | <code>string</code> | hdp插件名-默认PluginRouter（已废弃，不推荐使用） |
| functionName | <code>string</code> | hdp方法名-默认jumpApp（已废弃，不推荐使用） |
| iosVersion | <code>string</code> | ios最低支持版本号（已废弃，不推荐使用，建议使用资源位自带的设备判断） |
| iosMaxVersion | <code>string</code> | ios最高支持版本号（已废弃，不推荐使用，建议使用资源位自带的设备判断） |
| androidVersion | <code>string</code> | 安卓最低支持版本号（已废弃，不推荐使用，建议使用资源位自带的设备判断） |
| androidMaxVersion | <code>string</code> | 安卓最高支持版本号（已废弃，不推荐使用，建议使用资源位自带的设备判断） |


#### queryRule详解
```
<h5QueryKey1>:<appQueryKey1>;<h5QueryKey2>:<appQueryKey2>;
```
> 示例

配置为`type:tab;`时

在这条规则下，h5push时，传入`query.type = 1`时，会被转换成`query.tab = 1`


#### queryValueMap详解
```
<queryKey1>::<h5queryValue1>:<AppqueryValue1>,<h5queryValue2>:<AppqueryValue2>;<queryKey2>::<h5queryValue1>:<AppqueryValue1>,<h5queryValue2>:<AppqueryValue2>;
```
> 示例

配置为`tab::0:all,1:waitPay;`时

在这条规则下，h5push时，传入`query.tab = 1`时，会被转换成`query.tab = waitPay`

#### 资源位配置
![资源位配置](https://cdn.wanwudezhi.com/static/web-static/image/e904275a18cd246f911c3355e4fcaee5_896x993.jpg)

#### 添加资源位
![添加资源位](https://cdn.wanwudezhi.com/static/web-static/image/e904275a18cd246f911c3355e4fcaee5_896x993.jpg)

### replace工作流程图
![replace工作流程图](https://cdn.wanwudezhi.com/static/web-static/image/52c2c9b23ff80de9a9f4f14149889cd8_1331x849.png)

### CHANGELOG

* 日期：2020.09.29 作者：锦阳 内容：规则转map，优化性能，版本适配区间，选择最接近的区间
* 日期：2020.10.21 作者：锦阳 内容：支持选项callApp配置是否调用唤起app方案
