/*
 * @Author: lili
 * @Date: 2020-02-01 14:51:21
 * @LastEditors: Please set LastEditors
 * @LastEditTime: 2020年02月01日
 * @Description:
 */
// 页面停留时间
import { fn, ua } from "@wanwu/base-fn";
import rtp from "./rtp/rtp";
import send from "./util/send";
import traceUtil from "./util/trace";
// 开始时间与结束时间都存在进行页面停留时间进行埋点信息上报
export default function pageStayTime(nowReport) {
    let startTime = rtp.getPreStartTime();
    let endTime = rtp.getEndTime();
    var endStartTime = rtp.getStartTime();
    let loggerInfo = rtp.getLoggerInfo();
    if (endTime > 0 && endStartTime > 0 && endTime > startTime && loggerInfo && loggerInfo.event === "pageShow") {
        loggerInfo.event = "pageStayTime";
        // 当开始时间与结束时间都存在时上报埋点信息
        loggerInfo.ext = Object.assign({ duration: endTime - startTime, startTime: startTime, endTime: endTime }, loggerInfo.ext);
        // traceLink逻辑
        if (!ua.isApp()) {
            loggerInfo.traceLink = traceUtil.getTraceLink();
        }
        // 重置当前上报时间
        loggerInfo.timestamp = new Date().getTime();
        if (ua.isApp()) {
            if ((ua.getAppName() === 'wwdz_b2b' && fn.isLargerThanAppVersion("1.1.05")) || fn.isLargerThanAppVersion("2.7.6")) {
                send.logNewAppEvent(loggerInfo);
            }
        }
        else {
            send.sendNewLog([loggerInfo]);
        }
    }
}
