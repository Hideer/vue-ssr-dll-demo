## @wanwu/base-logger

**@wanwu/base-logger 是前端打点sdk**

## Install

``` shell
$ npm install --save @wanwu/base-logger
```

## Usage

```js
import {createRtpParams, logP, logE, VueLog} from '@wanwu/base-logger';
```


### createRtpParams
**rtp.setPageStayTime() 跳转保留结束的时间
**接收一个 URL 作为参数，返回带有 rtp 参数的 URL**
**rtp.setPageStayTime() 保存跳转的最后时间 用于页面上报停留时间**
### pageStayTime 页面停留时间上报方法，在logP中执行， 将进行下一个页面pageShow时存在localstorage去读取，进行时间差的上报
### logP

**页面的PV打点，一般情况下，无需主动调用**

接收参数
+ cur 当前页面url
+ ref 当前页面refer

```js
const url = createRtpParams(url)
```

### logE

**主动调用的自定义打点事件**

接收参数
+ eventId 业务打点事件id
+ ext     自定义传递参数

```js
logE(eventId, {...a, b})
```

### VueLog
**提供给Vue项目使用的Log插件**

```js
Vue.use(VueLog)
```

### createShareParams
**提供给业务的公用的分享埋点** 
1. 对分享页面的url进行处理，去除当前分享url的rtp参数，添加shareUserId, shareTime, firstVisit
2. 如当前url包含 shareUserId, shareTime， 则进行替换

### addReferRtp
**为了保证APP与小程序内H5的埋点链路的完整性**
- 添加当前页面的rtpCnt作为客户端的rtpUrl, 添加当前页的url为客户端的refer

## Options

**可选配置项，配置window下的RTP_PARAMS**

### RTP_PARAMS

```js
window.RTP_PARAMS = {
        // 打点地址
        LogUrl: 'https://api.wanwudezhi.com/api/logcenter/batchLog', // 批量
    
         // 获取用户信息的字段 
        UserInfoKey: 'userInfo',
    
        // 指定rtp_cnt的a字段
        rtp_cnt_a: '',
    
        // 指定rtp_cnt的b字段
        rtp_cnt_b: '',
    
        // eventId
        eventId: 10001,
    
        // platform
        platform: '',
    
        // 不需要上报的页面路由(无任何打点事件)
        ignorePageRegExp: [],
        // 间隔多长时间发送日志
        send_interval: 4000,
        // 一次请求最大发送几条数据，防止数据太大
        one_send_max_length: 6,
        // 正式环境的域名匹配
        env_production_host: /^h5\.wanwudezhi\.com/,
      
}        

```

[打点逻辑说明文档](http://wiki.wanwudezhi.com/document/index?document_id=146)

["pageShow","listClick", "elementClick", "dialogClick", "videoSwitch"] 当前的rtpCnt产生rptRfer
### 新版本埋点数据结构
```
{
event               // 事件名称，使用英文字母

env                 // 区分测试、预发、生产环境（develop, pre, production）
timestamp           // 上报的时间戳（毫秒值时间戳）

uuid                // 未注册用户的唯一标识
userId              // 用户唯一标识
basic               // 用户的系统、网络、权限等默认采集的参数

url                 // 用户当前url
refer               // 页面的上一个访问页面    
routing             // 页面路由
rtpCnt: 'a.b.c.d.e' // 本页面的rtp_cnt
rtpRefer: 'a.b.c.d.e', // 上一个页面的来源


ext{    
     // 不同业务规定的自定义上报信息
     pageParam  //打开此页面的携带信息
}
```


