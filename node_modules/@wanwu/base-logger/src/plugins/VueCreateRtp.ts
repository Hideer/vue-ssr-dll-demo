import { fn } from '@wanwu/base-fn'
import { createRtpParams } from '../index'

/**
 * 全局为跳转链接增加rtp参数
 * @param Vue
 * @param options
 */
const VueCreateRtp = (Vue, options: any = {}) => {
  // 有些页面没有记录的必要，可以加黑名单过滤避免加上rtp
  const { router, blackList } = options
  router.beforeEach((to, from, next) => {
    if (
      to.fullPath !== '/' &&
      (blackList ? blackList.indexOf(to.path) === -1 : true) &&
      !fn.getQueryString('rtp', to.fullPath)
    ) {
      next({ path: createRtpParams(to.fullPath), replace: true })
    } else {
      next()
    }
  })
}

export default {
  install(Vue, options) {
    VueCreateRtp(Vue, options)
  },
}
