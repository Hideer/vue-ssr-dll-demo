// 用于js代码跳转页面时 补充埋点信息
import { fn, ua } from "@wanwu/base-fn";
import crossUtil from "./cross";

const routeUtil = {
    // route跳转时需要默认拼上的参数
    paramsList: [
        'rtpApplication', 'traceLink'
    ],
    // url处理
    parseUrl(url) {
        try {
            this.paramsList.map((item) => {
                // 获取顺序window.name => sessionStorage => url
                let paramData = crossUtil.getWindowNameItem(item) || sessionStorage.getItem(item) || fn.getQueryString(item) || '';
                if (Object.prototype.toString.call(paramData) === "[object Object]") {
                    paramData = JSON.stringify(paramData)
                }
                if (url instanceof Object) {
                    const paramObj = {};
                    paramObj[item] = paramData;
                    url.query = Object.assign({}, url.query, paramObj);
                } else {
                    url = url.replace(/(#.+)$/, '');
                    url = fn.setQueryString(url, item, paramData);
                }
            });
            return url;
        } catch(err) {
            console.log(err)
        }
    }
};

export default routeUtil;
