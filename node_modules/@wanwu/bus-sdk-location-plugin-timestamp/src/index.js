/* 建议使用这个插件 */
export default genTimestampPlugin({
    whiteList: [
        '/mall-web',
        '/fission-web',
        '/live-web',
        '/community-web',
        '/product-web',
    ],
    originWhiteList: [
        'https://m.wanwudezhi.com',
    ],
});

/**
 *  接收options，返回插件，测试阶段或特殊项目使用
 * @param {Object} options 插件配置
 * @param {Array<string>} options.whiteList 需要加时间戳的项目base的白名单，每一项是类似`'/mall-web'`的`/`开头的base
 */
export function genTimestampPlugin(options) {
    const whiteList = options.whiteList || [];
    const originWhiteList = options.originWhiteList || [];
    return function (to) {
        if (new RegExp(`^(${whiteList.join('|')})$`).test(to.base) || new RegExp(`^(${originWhiteList.join('|')})$`).test(to.origin)) {
            const pattern = /(.*)\/\d{2,}$/;
            if (pattern.test(to.path)) {
                to.path = to.path.replace(pattern, '$1');
            }
            to.path += `/${Date.now()}`;
        }
        return to;
    };
}
