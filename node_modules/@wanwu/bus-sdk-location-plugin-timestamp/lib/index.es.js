import 'core-js/modules/es.array.join';
import 'core-js/modules/es.date.now';
import 'core-js/modules/es.date.to-string';
import 'core-js/modules/es.regexp.constructor';
import 'core-js/modules/es.regexp.exec';
import 'core-js/modules/es.regexp.to-string';
import 'core-js/modules/es.string.replace';

/* 建议使用这个插件 */
var index = genTimestampPlugin({
  whiteList: ['/mall-web', '/fission-web', '/live-web', '/community-web', '/product-web'],
  originWhiteList: ['https://m.wanwudezhi.com']
});
/**
 *  接收options，返回插件，测试阶段或特殊项目使用
 * @param {Object} options 插件配置
 * @param {Array<string>} options.whiteList 需要加时间戳的项目base的白名单，每一项是类似`'/mall-web'`的`/`开头的base
 */

function genTimestampPlugin(options) {
  var whiteList = options.whiteList || [];
  var originWhiteList = options.originWhiteList || [];
  return function (to) {
    if (new RegExp("^(".concat(whiteList.join('|'), ")$")).test(to.base) || new RegExp("^(".concat(originWhiteList.join('|'), ")$")).test(to.origin)) {
      var pattern = /(.*)\/\d{2,}$/;

      if (pattern.test(to.path)) {
        to.path = to.path.replace(pattern, '$1');
      }

      to.path += "/".concat(Date.now());
    }

    return to;
  };
}

export default index;
export { genTimestampPlugin };
