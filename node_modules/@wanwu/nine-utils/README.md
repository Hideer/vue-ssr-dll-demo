# nine-utils

九宫工具库

### nineProvideMixin

九宫上下文相关，我们提供了一个专门的地方来管理九宫上下文，主要功能如下：

1. 自动 provide 和 inject
2. 嵌套 provide 自动合并

使用：

```js
// provide

import { createNineProviderMixin } from "@wanwu/nine-utils";

export default {
  mixins: [createNineProviderMixin()],
  data() {
    return {
      nineProvideInfo: {},
    };
  },
};
```

你所有存储在`nineProvideInfo`上的信息都会被`provide`到子树上

```js
// inject

import { createNineInjectMixin } from "@wanwu/nine-utils";

export default {
  mixins: [createNineInjectMixin("localName")],
};
```

其中`localName`是你希望通过`this.xxx`访问 inject 的变量明。之后你就可以通过`this.localName`访问所有 provide 的信息

### fixed top helper

在九宫中有一个非常常见的需求就是吸顶，因为可能存在嵌套组件都需要吸顶的可能（比如 tabs 下有一个分类组件，他们会同时吸顶），所以这里提供一个工具来帮助维护这种关系

```js
import {
  // createNineInjectMixin,
  createNineFixedHelper,
} from "../../src/index";

export defualt {
  mixins: [createNineFixedHelper('name')]
}
```

该 mixin 和 inject 接收相同参数，但是他们的作用完全不通，首先，他们该 mixin 会同时支持`provide`和`inject`，也就是使用了该 mixin 就不需要再使用上面两个，他们的功能在这里都有。

其次，该 mixin 提供了一些便捷属性，让我们做逻辑判断：

```js
computed: {
  hasFixedParent() {
    // 是否有可吸顶的组件
  },
  isParentFixed() {
    // 父组件是否吸顶
  },
  fixedTop() {
    // 吸顶的时候top需要设置的值
    // 等于父组件的top值加上父组件的吸顶部分高度
  },
  childFixedTop() {
    // 子组件获取到的`fixedTop`
    // 会自动provide下去
  },
},
```

另外在你的组件的`data`中，你需要提供两个值`isFixed`和`fixedHeight`来维护组件是否吸顶的状态和吸顶部分的高度，你可以直接写死或者根据一些规则进行计算，只要把最终结果维护到这两个值上即可。

### provide 规范

埋点信息：

```js
import { createNineProviderMixin } from "@wanwu/nine-utils";

export default {
  mixins: [createNineProviderMixin()],
  data() {
    return {
      nineProvideInfo: {
        agentTraceInfo_: {
          cur: [""],
        },
      },
    };
  },
};
```

吸顶：

```js
import { createNineProviderMixin, createNineInjectMixin } from "@wanwu/nine-utils";

export default {
  mixins: [createNineProviderMixin()],
  data() {
    return {
      nineProvideInfo: {
        fixedToTop: {
          isFxied: true,
          heighet: 100,
        },
      },
    };
  },
};

// 对于使用者来说：
{
  mixins: [createNineInjectMixin('abc')],
  computed: {
    top() {
      return this.abc.fixedToTop && this.abc.fixedToTop.height
    }
  }
};
```
